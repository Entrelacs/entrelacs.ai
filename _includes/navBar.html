<nav class="navbar">
  <div class="nav_container">
    
    <a href="{{ site.baseurl }}/" class="logo">
      <img src="/images/logo.png" alt="Entrelacs Logo">
      Entrelacs
    </a>

    <div class="hamburger" id="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </div>

    <ul class="navLinks">
      <li><a href="{{ site.baseurl }}/">{% t navigation.home %}</a></li>
      <li><a href="{{ site.baseurl }}/employers/">{% t navigation.employers %}</a></li>
      <li><a href="{{ site.baseurl }}/healthcare/">{% t navigation.healthcare %}</a></li>
      <li><a href="{{ site.baseurl }}/technology/">{% t navigation.technology %}</a></li>
      <li><a href="{{ site.baseurl }}/about/">{% t navigation.about %}</a></li>
    </ul>
    
    <ul class="navLinks">
      <li><a class="cta" href="{{ site.baseurl }}/contact-us/">{% t navigation.contact %}</a></li>
      <li>{% include language_switcher.html %}</li>
    </ul>

    <div class="mobileMenu" id="mobileMenu" style="display: none;">
      <ul>
        <li><a href="{{ site.baseurl }}/">{% t navigation.home %}</a></li>
        <li><a href="{{ site.baseurl }}/employers/">{% t navigation.employers %}</a></li>
        <li><a href="{{ site.baseurl }}/healthcare/">{% t navigation.healthcare %}</a></li>
        <li><a href="{{ site.baseurl }}/technology/">{% t navigation.technology %}</a></li>
        <li><a href="{{ site.baseurl }}/about/">{% t navigation.about %}</a></li>
        <li><a class="cta" href="{{ site.baseurl }}/contact-us/">{% t navigation.contact %}</a></li>
        <li>{% include language_switcher.html %}</li>
      </ul>
    </div>
  </div>
</nav>

<script>
  const hamburger = document.getElementById('hamburger');
  const mobileMenu = document.getElementById('mobileMenu');
  let menuOpen = false;

  hamburger.addEventListener('click', () => {
    menuOpen = !menuOpen;

    // Toggle mobile menu display
    mobileMenu.style.display = menuOpen ? 'block' : 'none';

    // Animate hamburger spans
    const spans = hamburger.querySelectorAll('span');
    spans[0].style.transform = menuOpen ? 'rotate(45deg) translate(5px, 6px)' : 'none';
    spans[1].style.opacity = menuOpen ? 0 : 1;
    spans[2].style.transform = menuOpen ? 'rotate(-45deg) translate(5px, -7px)' : 'none';
  });

  // Optional: close menu when mobile links are clicked
  mobileMenu.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      menuOpen = false;
      mobileMenu.style.display = 'none';
      const spans = hamburger.querySelectorAll('span');
      spans[0].style.transform = 'none';
      spans[1].style.opacity = 1;
      spans[2].style.transform = 'none';
    });
  });

  // Mark Nav item as active if the url matches it
  function setActiveNav() {
      // Get current path and remove trailing slash (unless it is just "/")
      // e.g. "/fr/employers/" becomes "/fr/employers"
      let currentPath = window.location.pathname.replace(/\/$/, "") || "/";

      const navLinks = document.querySelectorAll(".navLinks a");

      navLinks.forEach(link => {
        // Extract the path from the link (ignoring domain)
        const urlObj = new URL(link.href);
        let linkPath = urlObj.pathname.replace(/\/$/, "") || "/";

        // Check if this link is a "Home" link (Root "/" or Lang Root "/fr")
        // Regex explains: Starts with /, has 2 letters, ends. (Matches /fr, /en, /es)
        const isHomeLink = linkPath === "/" || /^\/[a-z]{2}$/i.test(linkPath);

        let isActive = false;

        if (isHomeLink) {
          // Rule: Home links only active on EXACT match
          // Prevents "/fr" from lighting up when you are on "/fr/about"
          isActive = (currentPath === linkPath);
        } else {
          // Rule: Other links active on EXACT match OR Sub-path match
          // e.g. "/employers" lights up if you are on "/employers/team"
          isActive = (currentPath === linkPath || currentPath.startsWith(linkPath + "/"));
        }

        // Apply class
        if (isActive) {
          link.classList.add("navactive");
        } else {
          link.classList.remove("navactive");
        }
      });
    }

    // Run immediately
    setActiveNav();
</script>